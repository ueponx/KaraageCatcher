<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂîêÊèö„Åí„Ç≠„É£„ÉÉ„ÉÅ„Ç≤„Éº„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(to bottom, #87CEEB 0%, #87CEEB 70%, #90EE90 70%, #90EE90 100%);
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }

        #gameContainer {
            position: relative;
            width: 800px;
            height: 600px;
            background: linear-gradient(to bottom, #87CEEB 0%, #87CEEB 65%, #90EE90 65%, #90EE90 100%);
            border: 4px solid #333;
            overflow: hidden;
        }

        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            z-index: 10;
        }

        #timer {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            z-index: 10;
        }

        #timerBar {
            position: absolute;
            top: 45px;
            right: 10px;
            width: 200px;
            height: 20px;
            background: rgba(0,0,0,0.5);
            border: 2px solid white;
            border-radius: 10px;
            overflow: hidden;
            z-index: 10;
        }

        #timerBarFill {
            height: 100%;
            background: linear-gradient(to right, #4CAF50, #FFC107, #F44336);
            transition: width 0.1s linear;
        }

        #stunIndicator {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            color: #FFD700;
            font-size: 28px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            display: none;
            z-index: 10;
        }

        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            display: none;
            z-index: 20;
        }

        #gameOver h2 {
            font-size: 36px;
            margin-bottom: 20px;
            color: #FFD700;
        }

        #gameOver p {
            font-size: 24px;
            margin-bottom: 30px;
        }

        #restartBtn {
            padding: 15px 40px;
            font-size: 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
        }

        #restartBtn:hover {
            background: #45a049;
        }

        #instructions {
            position: absolute;
            bottom: 10px;
            left: 10px;
            color: white;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div id="ui">
            „Çπ„Ç≥„Ç¢: <span id="score">0</span>
        </div>
        <div id="timer">
            ÊÆã„ÇäÊôÇÈñì: <span id="timeLeft">60</span>Áßí
        </div>
        <div id="timerBar">
            <div id="timerBarFill" style="width: 100%"></div>
        </div>
        <div id="stunIndicator">üòµ „Çπ„Çø„É≥‰∏≠ÔºÅ üòµ</div>
        <div id="instructions">
            Êìç‰Ωú: ‚Üê ‚Üí ÁßªÂãï | „Çπ„Éö„Éº„Çπ „Ç∏„É£„É≥„Éó<br>
            üçó ÂîêÊèö„Åí = +1ÁÇπ | üçã „É¨„É¢„É≥ = 2Áßí„Çπ„Çø„É≥
        </div>
        <div id="gameOver">
            <h2>„Ç≤„Éº„É†ÁµÇ‰∫ÜÔºÅ</h2>
            <p>ÊúÄÁµÇ„Çπ„Ç≥„Ç¢: <span id="finalScore">0</span>ÁÇπ</p>
            <button id="restartBtn">„ÇÇ„ÅÜ‰∏ÄÂ∫¶„Éó„É¨„Ç§</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // „Ç≤„Éº„É†Áä∂ÊÖã
        let gameState = {
            score: 0,
            timeLeft: 60,
            gameRunning: true,
            isStunned: false,
            stunTimer: 0
        };

        // „Éó„É¨„Ç§„É§„Éº
        const player = {
            x: 400,
            y: 480,
            width: 40,
            height: 60,
            speed: 5,
            jumpPower: 15,
            velocityY: 0,
            gravity: 0.6,
            isJumping: false,
            groundY: 480
        };

        // Êäï„Åí„Çã‰∫∫
        const thrower = {
            x: 400,
            y: 360,
            width: 40,
            height: 50,
            throwAnimation: 0
        };

        // „Ç¢„Ç§„ÉÜ„É†ÈÖçÂàó
        let items = [];

        // „Ç≠„ÉºÂÖ•Âäõ
        const keys = {};
        
        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === ' ' && !player.isJumping && gameState.gameRunning && !gameState.isStunned) {
                player.velocityY = -player.jumpPower;
                player.isJumping = true;
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        document.getElementById('restartBtn').addEventListener('click', restartGame);

        // È≥•Â±Ö„ÇíÊèèÁîª
        function drawTorii() {
            ctx.fillStyle = '#D2691E';
            
            // Êü±ÔºàÂ∑¶Ôºâ- È´ò„Åï240„Éî„ÇØ„Çª„É´
            ctx.fillRect(200, 280, 20, 240);
            // Êü±ÔºàÂè≥Ôºâ
            ctx.fillRect(580, 280, 20, 240);
            
            // ‰∏ä„ÅÆÊ®™Êú®
            ctx.fillRect(180, 260, 440, 15);
            ctx.fillRect(170, 250, 460, 10);
            
            // ‰∏ã„ÅÆÊ®™Êú®
            ctx.fillRect(190, 310, 420, 12);
            
            // Ë£ÖÈ£æ
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(185, 265, 10, 10);
            ctx.fillRect(605, 265, 10, 10);
        }

        // Êäï„Åí„Çã‰∫∫„ÇíÊèèÁîª
        function drawThrower() {
            // È†≠
            ctx.fillStyle = '#FFD1A3';
            ctx.beginPath();
            ctx.arc(thrower.x, thrower.y, 15, 0, Math.PI * 2);
            ctx.fill();
            
            // ‰Ωì
            ctx.fillStyle = '#FF6B6B';
            ctx.fillRect(thrower.x - 12, thrower.y + 10, 24, 30);
            
            // Êäï„Åí„Çã„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
            const armOffset = Math.max(0, thrower.throwAnimation);
            
            // ËÖïÔºàÊäï„Åí„Çã„Éù„Éº„Ç∫Ôºâ
            ctx.strokeStyle = '#FF6B6B';
            ctx.lineWidth = 6;
            
            // Â∑¶ËÖï
            ctx.beginPath();
            ctx.moveTo(thrower.x - 12, thrower.y + 15);
            ctx.lineTo(thrower.x - 25, thrower.y + 5);
            ctx.stroke();
            
            // Âè≥ËÖïÔºàÊäï„Åí„ÇãËÖïÔºâ
            ctx.beginPath();
            ctx.moveTo(thrower.x + 12, thrower.y + 15);
            ctx.lineTo(thrower.x + 25 - armOffset * 10, thrower.y + 25 - armOffset * 30);
            ctx.stroke();
            
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Ê∏õË°∞
            if (thrower.throwAnimation > 0) {
                thrower.throwAnimation -= 0.1;
            }
        }

        // „Éó„É¨„Ç§„É§„Éº„ÇíÊèèÁîª
        function drawPlayer() {
            const opacity = gameState.isStunned ? 0.5 : 1;
            ctx.globalAlpha = opacity;
            
            // È†≠
            ctx.fillStyle = '#FFD1A3';
            ctx.beginPath();
            ctx.arc(player.x, player.y - 45, 15, 0, Math.PI * 2);
            ctx.fill();
            
            // ‰Ωì
            ctx.fillStyle = '#4169E1';
            ctx.fillRect(player.x - 15, player.y - 30, 30, 35);
            
            // ËÖï
            ctx.strokeStyle = '#4169E1';
            ctx.lineWidth = 6;
            ctx.beginPath();
            ctx.moveTo(player.x - 15, player.y - 25);
            ctx.lineTo(player.x - 25, player.y - 10);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(player.x + 15, player.y - 25);
            ctx.lineTo(player.x + 25, player.y - 10);
            ctx.stroke();
            
            // Ë∂≥
            ctx.beginPath();
            ctx.moveTo(player.x - 5, player.y + 5);
            ctx.lineTo(player.x - 10, player.y + 25);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(player.x + 5, player.y + 5);
            ctx.lineTo(player.x + 10, player.y + 25);
            ctx.stroke();
            
            ctx.globalAlpha = 1;
        }

        // ÂîêÊèö„Åí„ÇíÊèèÁîª
        function drawKaraage(x, y, size) {
            ctx.fillStyle = '#D2691E';
            ctx.beginPath();
            ctx.arc(x, y, size, 0, Math.PI * 2);
            ctx.fill();
            
            // „Éè„Ç§„É©„Ç§„Éà
            ctx.fillStyle = '#F4A460';
            ctx.beginPath();
            ctx.arc(x - size/3, y - size/3, size/3, 0, Math.PI * 2);
            ctx.fill();
            
            // Á¥∞„Åã„ÅÑÂáπÂá∏
            ctx.fillStyle = '#8B4513';
            for (let i = 0; i < 3; i++) {
                const angle = (Math.PI * 2 * i) / 3;
                const dx = Math.cos(angle) * size * 0.6;
                const dy = Math.sin(angle) * size * 0.6;
                ctx.fillRect(x + dx - 2, y + dy - 2, 3, 3);
            }
        }

        // „É¨„É¢„É≥„ÇíÊèèÁîª
        function drawLemon(x, y, size) {
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.ellipse(x, y, size, size * 1.3, Math.PI / 4, 0, Math.PI * 2);
            ctx.fill();
            
            // „Éè„Ç§„É©„Ç§„Éà
            ctx.fillStyle = '#FFED4E';
            ctx.beginPath();
            ctx.ellipse(x - size/3, y - size/3, size/3, size/2, Math.PI / 4, 0, Math.PI * 2);
            ctx.fill();
            
            // Ëº™ÈÉ≠
            ctx.strokeStyle = '#FFA500';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.ellipse(x, y, size, size * 1.3, Math.PI / 4, 0, Math.PI * 2);
            ctx.stroke();
        }

        // „Ç¢„Ç§„ÉÜ„É†„ÇíÁîüÊàêÔºà‰∏ÄÂõû„Åß4„Å§Êäï„Åí„ÇãÔºâ
        function createItem() {
            // Êäï„Åí„Çã‰∫∫„ÅÆ‰ΩçÁΩÆ„Åã„ÇâÊäï„Åí„Çã
            const startX = thrower.x;
            const startY = thrower.y + 30;
            
            // Êäï„Åí„Çã„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Çí„Éà„É™„Ç¨„Éº
            thrower.throwAnimation = 1;
            
            // 4„Å§„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÇíÊäï„Åí„Çã
            for (let i = 0; i < 4; i++) {
                const type = Math.random() < 0.9 ? 'karaage' : 'lemon'; // 90%ÂîêÊèö„Åí„ÄÅ10%„É¨„É¢„É≥
                
                // „É©„É≥„ÉÄ„É†„Å™ÊñπÂêë„Å´Êäï„Åí„ÇãÔºàÂ∑¶Âè≥„Å´Â∫É„Åå„Çã„Çà„ÅÜ„Å´Ôºâ
                const angle = -50 - Math.random() * 80; // -50Â∫¶„Åã„Çâ-130Â∫¶„ÅÆÁØÑÂõ≤
                const power = 7 + Math.random() * 5; // Êäï„Åí„ÇãÂäõ
                
                items.push({
                    x: startX,
                    y: startY,
                    type: type,
                    velocityX: Math.cos(angle * Math.PI / 180) * power,
                    velocityY: Math.sin(angle * Math.PI / 180) * power,
                    gravity: 0.3,
                    size: 15
                });
            }
        }

        // Ë°ùÁ™ÅÂà§ÂÆö
        function checkCollision(item) {
            const distance = Math.sqrt(
                Math.pow(item.x - player.x, 2) + 
                Math.pow(item.y - (player.y - 30), 2)
            );
            return distance < (item.size + 20);
        }

        // „Éó„É¨„Ç§„É§„ÉºÊõ¥Êñ∞
        function updatePlayer() {
            if (!gameState.isStunned && gameState.gameRunning) {
                // Â∑¶Âè≥ÁßªÂãï
                if (keys['ArrowLeft'] || keys['a']) {
                    player.x -= player.speed;
                }
                if (keys['ArrowRight'] || keys['d']) {
                    player.x += player.speed;
                }
            }

            // ÁîªÈù¢Á´ØÂà∂Èôê
            player.x = Math.max(20, Math.min(780, player.x));

            // „Ç∏„É£„É≥„ÉóÂá¶ÁêÜ
            player.velocityY += player.gravity;
            player.y += player.velocityY;

            // ÁùÄÂú∞Âà§ÂÆö
            if (player.y >= player.groundY) {
                player.y = player.groundY;
                player.velocityY = 0;
                player.isJumping = false;
            }

            // „Çπ„Çø„É≥Âá¶ÁêÜ
            if (gameState.isStunned) {
                gameState.stunTimer -= 1/60;
                if (gameState.stunTimer <= 0) {
                    gameState.isStunned = false;
                    document.getElementById('stunIndicator').style.display = 'none';
                }
            }
        }

        // „Ç¢„Ç§„ÉÜ„É†Êõ¥Êñ∞
        function updateItems() {
            for (let i = items.length - 1; i >= 0; i--) {
                // ÊîæÁâ©ÈÅãÂãï„ÇíÈÅ©Áî®
                items[i].velocityY += items[i].gravity;
                items[i].x += items[i].velocityX;
                items[i].y += items[i].velocityY;

                // Ë°ùÁ™ÅÂà§ÂÆö
                if (checkCollision(items[i])) {
                    if (items[i].type === 'karaage') {
                        gameState.score++;
                        document.getElementById('score').textContent = gameState.score;
                    } else if (items[i].type === 'lemon') {
                        gameState.isStunned = true;
                        gameState.stunTimer = 2;
                        document.getElementById('stunIndicator').style.display = 'block';
                    }
                    items.splice(i, 1);
                } else if (items[i].y > 600 || items[i].x < -50 || items[i].x > 850) {
                    // ÁîªÈù¢Â§ñ„Å´Âá∫„Åü„ÇâÂâäÈô§
                    items.splice(i, 1);
                }
            }
        }

        // ÊèèÁîª
        function draw() {
            // ËÉåÊôØ„ÇØ„É™„Ç¢
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Âú∞Èù¢
            ctx.fillStyle = '#8B7355';
            ctx.fillRect(0, 540, 800, 60);

            // Ëçâ
            ctx.fillStyle = '#228B22';
            for (let i = 0; i < 800; i += 20) {
                ctx.fillRect(i, 535, 10, 10);
            }

            // È≥•Â±Ö
            drawTorii();

            // Êäï„Åí„Çã‰∫∫
            drawThrower();

            // „Ç¢„Ç§„ÉÜ„É†
            items.forEach(item => {
                if (item.type === 'karaage') {
                    drawKaraage(item.x, item.y, item.size);
                } else {
                    drawLemon(item.x, item.y, item.size);
                }
            });

            // „Éó„É¨„Ç§„É§„Éº
            drawPlayer();
        }

        // „Ç≤„Éº„É†„É´„Éº„Éó
        let lastItemTime = 0;
        let gameTime = 0;

        function gameLoop() {
            if (!gameState.gameRunning) return;

            gameTime += 1/60;

            // „Ç¢„Ç§„ÉÜ„É†ÁîüÊàêÔºà0.4Áßí„Åî„Å®Ôºâ
            if (gameTime - lastItemTime > 0.4) {
                createItem();
                lastItemTime = gameTime;
            }

            updatePlayer();
            updateItems();
            draw();

            requestAnimationFrame(gameLoop);
        }

        // „Çø„Ç§„Éû„ÉºÊõ¥Êñ∞
        function updateTimer() {
            if (!gameState.gameRunning) return;

            gameState.timeLeft--;
            document.getElementById('timeLeft').textContent = gameState.timeLeft;
            
            // „Çø„Ç§„Éû„Éº„Éê„ÉºÊõ¥Êñ∞
            const percentage = (gameState.timeLeft / 60) * 100;
            document.getElementById('timerBarFill').style.width = percentage + '%';

            if (gameState.timeLeft <= 0) {
                endGame();
            } else {
                setTimeout(updateTimer, 1000);
            }
        }

        // „Ç≤„Éº„É†ÁµÇ‰∫Ü
        function endGame() {
            gameState.gameRunning = false;
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('gameOver').style.display = 'block';
        }

        // „Ç≤„Éº„É†ÂÜçÈñã
        function restartGame() {
            gameState = {
                score: 0,
                timeLeft: 60,
                gameRunning: true,
                isStunned: false,
                stunTimer: 0
            };
            
            player.x = 400;
            player.y = 480;
            player.velocityY = 0;
            player.isJumping = false;
            
            thrower.throwAnimation = 0;
            
            items = [];
            gameTime = 0;
            lastItemTime = 0;
            
            document.getElementById('score').textContent = '0';
            document.getElementById('timeLeft').textContent = '60';
            document.getElementById('timerBarFill').style.width = '100%';
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('stunIndicator').style.display = 'none';
            
            gameLoop();
            updateTimer();
        }

        // „Ç≤„Éº„É†ÈñãÂßã
        gameLoop();
        updateTimer();
    </script>
</body>
</html>
